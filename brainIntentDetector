// =======================================================
// brainIntentDetector.js
// كاشف اللغة + اللهجة + النية + AI domain
// =======================================================

function detectLanguage(text = "") {
  const enOnly = /^[0-9a-zA-Z\s.,;:!?'"()@#%&*\-_/\\]+$/;
  return enOnly.test(text) ? "en" : "ar";
}

function detectDialect(text = "") {
  const t = text.toLowerCase();

  const gulf = ["وش","ليه","هاالشي","مره","واجد","شلون","يعطيك"];
  const egy  = ["ازاي","كده","ليه","عايز","دلوقتي","جامد"];
  const lev  = ["ليش","شو","هيك","كتير","لسا","هلق"];
  const magh = ["بزاف","علاش","ديما","برشا","تصاور"];

  const has = arr => arr.some(w => t.includes(w));

  if (has(gulf)) return "gulf";
  if (has(egy)) return "egyptian";
  if (has(lev)) return "levant";
  if (has(magh)) return "maghrebi";
  return "msa";
}

function detectIntent(text = "") {
  const t = text.toLowerCase();

  const map = require("./nova-brain.v3.config").NOVA_BRAIN_V3.INTENTS;

  for (const intent in map) {
    const wordsAR = map[intent].AR || [];
    const wordsEN = map[intent].EN || [];

    if (wordsAR.some(w => t.includes(w.toLowerCase()))) return intent;
    if (wordsEN.some(w => t.includes(w.toLowerCase()))) return intent;
  }
  return "GENERAL";
}

function isAIDomain(text = "") {
  const t = text.toLowerCase();
  const cfg = require("./nova-brain.v3.config").NOVA_BRAIN_V3.DOMAIN_KEYWORDS;

  return (
    cfg.AI_AR.some(w => t.includes(w.toLowerCase())) ||
    cfg.AI_EN.some(w => t.includes(w.toLowerCase()))
  );
}

module.exports = {
  detectLanguage,
  detectDialect,
  detectIntent,
  isAIDomain
};
