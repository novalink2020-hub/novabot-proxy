novaIntentDetector.js
// ===========================================
// novaIntentDetector.js
// ูุดู ููุงูุง ูููุง ุจูุช (ุฐูุงุก ุงุตุทูุงุนู + ุชุทููุฑ ุฃุนูุงู + ููุงูุง ุชุนุฑูููุฉ)
// By Mohammed Abu Snaina โ NOVALINK.AI
// ===========================================

/**
 * ููุงุญุธุงุช ุชุตููู:
 * - ููุท intent: "ai_business" ูุณุชุฏุนู Gemini ูู novaBrainSystem.
 * - ุจุงูู ุงูููุงูุง ุชุณุชุฎุฏู ุฑุฏูุฏ ุซุงุจุชุฉ ูุคุชูุชุฉ (ุตูุฑ ุชูููุฉ ุชูููุฒ).
 * - ุฃู ููุถูุน ุฎุงุฑุฌ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุชุทููุฑ ุงูุฃุนูุงู โ out_of_scope โ ุฑุฏ ุชุญููุฒู.
 * - ุฏุนู ููุฌุงุช: ุดุงููุฉุ ูุตุฑูุฉุ ุฎููุฌูุฉุ ูุบุงุฑุจูุฉ ุนูู ูุณุชูู ุงูุชุญููู ููุท.
 */
console.log("๐ฏ IntentDetector V5.1 loaded at", new Date().toISOString());
const ARABIC_RANGE_RE = /[\u0600-\u06FF]/;

/* ================= ุฃุฏูุงุช ูุณุงุนุฏุฉ ูููุต ================= */

function normalize(str = "") {
  return str
    .toLowerCase()
    .replace(/[.,!?ุุ"โโ()\-_:\;ยซยป[\]{}/\\]+/g, " ")
    .replace(/\s+/g, " ")
    .trim();
}

function containsAny(text, list) {
  if (!text) return false;
  for (const kw of list) {
    if (!kw) continue;
    if (text.includes(kw)) return true;
  }
  return false;
}

function scoreByKeywords(text, list) {
  if (!text) return 0;
  let score = 0;
  for (const kw of list) {
    if (!kw) continue;
    if (text.includes(kw)) score += 1;
  }
  return score;
}

/* ============== ูุดู ุงููุบุฉ ูุงูููุฌุฉ ============== */

function detectLanguage(originalText = "") {
  if (!originalText) return "ar";
  return ARABIC_RANGE_RE.test(originalText) ? "ar" : "en";
}

function detectDialect(cleanText = "") {
  // ุดุงููุฉ
  const levantWords = [
    "ุดู",
    "ููุด",
    "ูููู",
    "ููู",
    "ูุณุง",
    "ูุณู",
    "ูุณุง",
    "ุณูุงูุงุช",
    "ุชูุงู ุนููู",
    "ุจุฏู",
    "ุจุฏู",
    "ูุชูุฑ",
    "ุนูุฌุฏ",
    "ูู ููู",
    "ูู ูุซูุฑ",
    "ูุณุงุชูู",
    "ูุณุงุชู"
  ];

  // ุฎููุฌูุฉ
  const gulfWords = [
    "ูุงูุฏ",
    "ูุงุฌุฏ",
    "ุฒูุฏ",
    "ูุฑู",
    "ูุฑุฉ ุญูู",
    "ุญูู",
    "ุดููู",
    "ุดู ุฑุงูู",
    "ูุง ุฑุฌุงู",
    "ุชูู",
    "ุชููู",
    "ุณูู",
    "ุณููุช",
    "ุฏูู",
    "ููููุฑ"
  ];

  // ูุตุฑูุฉ
  const egyptWords = [
    "ุงุฒุงู",
    "ุงุฒุงู",
    "ููู",
    "ููู",
    "ูููุณ",
    "ุชูุงู ุงูู",
    "ุงูู",
    "ุฎุงูุต",
    "ูุณู",
    "ุฏูููุชู",
    "ุฏูููุชู",
    "ุนุงูุฒ",
    "ุนุงูุฒู",
    "ุนุงูุฒุฉ",
    "ุฌุงูุฏ",
    "ุจุฌุฏ",
    "ุชุญูู",
    "ุชุญูุฉ"
  ];

  // ูุบุงุฑุจูุฉ
  const maghrebWords = [
    "ุจุฒุงู",
    "ุจุฒูุงู",
    "ูุงุด",
    "ุดูู",
    "ุดุญุงู",
    "ุจุงุบู",
    "ุจุบูุช",
    "ุฏุงุจุง",
    "ููุง",
    "ููุงู",
    "ุจุฑุดุง"
  ];

  if (containsAny(cleanText, levantWords)) return "levant";
  if (containsAny(cleanText, gulfWords)) return "gulf";
  if (containsAny(cleanText, egyptWords)) return "egypt";
  if (containsAny(cleanText, maghrebWords)) return "maghreb";

  return "msa"; // ูุตุญู / ุนุงู ุนุฑุจู ุนุงู
}

/* ============== ูุฌููุนุงุช ุงููููุงุช ุงูููุชุงุญูุฉ ููููุงูุง ============== */

/**
 * 1) ููุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูุชุทููุฑ ุงูุฃุนูุงู
 *    (ูู ุงูููุฉ ุงููุญูุฏุฉ ุงูุชู ุชุณุชุฏุนู Gemini)
 */
const AI_BUSINESS_KEYWORDS = [
  // ุนุฑุจู ุนุงู ุนู ุงูุฐูุงุก ุงูุงุตุทูุงุนู
  "ุฐูุงุก ุงุตุทูุงุนู",
  "ุงูุฐูุงุก ุงูุงุตุทูุงุนู",
  "ุฐูุงุก ุฅุตุทูุงุนู",
  "ุฐูุงุก ุตูุงุนู",
  "ุฐูุงุก ุตูุนู",
  "ุชุนูู ุขูู",
  "ุชุนูู ุขูู",
  "ุชุนูู ุนููู",
  "ูููุฐุฌ ูุบูู",
  "ููุงุฐุฌ ูุบููุฉ",
  "ูููุฐุฌ ูุบุฉ",
  "ุจุฑููุจุช",
  "ุจุฑููุจุชุงุช",
  "ุงูุชููุงุชูุดู",
  "ุฃุชูุชุฉ",
  "ุงูุชูุชุฉ",
  "ุงุชูุชุฉ",
  "ุชุดุงุช ุจูุช",
  "ุดุงุช ุจูุช",
  "ุฑูุจูุช ุฏุฑุฏุดุฉ",
  "ูุณุงุนุฏ ุฐูู",
  "ูููู ุฐูู",
  "ุนููู ุฐ
